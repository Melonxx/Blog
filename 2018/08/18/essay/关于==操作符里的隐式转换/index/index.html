<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><title>关于 == 操作符里的隐式转换 | zch233</title><link rel="stylesheet" type="text/css" href="/Blog/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/Blog/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/Blog/favicon.ico"><link rel="apple-touch-icon" href="/Blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/Blog/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">关于 == 操作符里的隐式转换</h1><a id="logo" href="/Blog/.">zch233</a><p class="description">人到中年</p></div><div id="nav-menu"><a class="current" href="/Blog/."><i class="fa fa-home"> Home</i></a><a href="/Blog/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">关于 == 操作符里的隐式转换</h1><div class="post-meta">2018-08-18<span> | </span><span class="category"><a href="/Blog/categories/%E9%9A%8F%E7%AC%94/">随笔</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A5%E7%9C%8B%E5%87%A0%E9%81%93%E7%BB%8F%E5%85%B8%E7%9A%84%E9%A2%98%E7%9B%AE%EF%BC%9A"><span class="toc-number"></span> <span class="toc-text">来看几道经典的题目：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%98%AF%E4%B8%8D%E6%98%AF%E5%BE%88%E5%A5%87%E6%80%AA%EF%BC%9F%E6%9C%AC%E6%96%87%E5%B0%86%E4%BB%8E%E4%B9%A6%E4%B8%AD%E7%9C%8B%E5%88%B0%E7%9A%84%E7%9F%A5%E8%AF%86%E4%B8%8E%E8%A7%84%E8%8C%83%E7%9B%B8%E7%BB%93%E5%90%88%EF%BC%8C%E6%9D%A5%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8BJavaScript%E5%9C%A8%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%97%B6%E5%80%99%E5%8F%91%E7%94%9F%E7%9A%84%E6%95%85%E4%BA%8B%E3%80%82"><span class="toc-number">0.0.1.</span> <span class="toc-text">是不是很奇怪？本文将从书中看到的知识与规范相结合，来详细说明一下JavaScript在类型转换时候发生的故事。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JS%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">JS的数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ToPrimitive"><span class="toc-number">2.</span> <span class="toc-text">ToPrimitive</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%AD%BE%E5%90%8D%EF%BC%9AToPrimitive-input-PreferredType-x2F-x2F-PreferredType-Number-%E6%88%96%E8%80%85-String"><span class="toc-number">2.0.1.</span> <span class="toc-text">签名：ToPrimitive(input, PreferredType?) &#x2F;&#x2F;PreferredType: Number 或者 String</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">2.0.2.</span> <span class="toc-text">流程如下：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-x3D-x3D-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text">总结：&#x3D;&#x3D;操作符</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97-x-x3D-x3D-y%EF%BC%8C%E5%85%B6%E4%B8%ADx%E5%92%8Cy%E6%98%AF%E5%80%BC%EF%BC%8C%E4%BA%A7%E7%94%9Ftrue%E6%88%96%E8%80%85false%E3%80%82%E8%BF%99%E6%A0%B7%E7%9A%84%E6%AF%94%E8%BE%83%E5%A6%82%E4%B8%8B%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">比较运算 x&#x3D;&#x3D;y，其中x和y是值，产生true或者false。这样的比较如下方式进行：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8A%E5%9B%BE%E4%B8%AD%E7%9A%84-toPrimitive-%E5%B0%B1%E6%98%AF%E5%AF%B9%E8%B1%A1%E8%BD%AC%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E3%80%82"><span class="toc-number">3.1.1.</span> <span class="toc-text">上图中的 toPrimitive 就是对象转基本类型。</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%9D%A5%E8%A7%A3%E6%9E%90%E4%B8%80%E9%81%93%E9%A2%98%E7%9B%AE-x3D-x3D-x2F-x2F-gt-true-%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%98%AF%E8%BF%99%E4%B8%AA%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%BA%E4%BD%95%E4%B8%BA-true-%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.2.</span> <span class="toc-text">这里来解析一道题目 [] &#x3D;&#x3D; ![] &#x2F;&#x2F; -&gt; true ，下面是这个表达式为何为 true 的步骤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8"><span class="toc-number">4.</span> <span class="toc-text">备注</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ToNumber"><span class="toc-number">4.1.</span> <span class="toc-text">ToNumber</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ToBoolean"><span class="toc-number">4.2.</span> <span class="toc-text">ToBoolean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ToPrimitive-1"><span class="toc-number">4.3.</span> <span class="toc-text">ToPrimitive</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#DefaultValue-hint"><span class="toc-number">4.3.1.</span> <span class="toc-text">[[DefaultValue]] (hint)</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>类型转换在各个语言中都存在，而在 JavaScript 中由于缺乏对其的了解而不慎在使用中经常造成bug被人诟病。为了避免某些场景下的意外，甚至推崇直接使用 Strict Equality( &#x3D;&#x3D;&#x3D; )来代替 &#x3D;&#x3D;（最新的eslint规则默认就是使用&#x3D;&#x3D;&#x3D;）。这确实能避免很多bug，但更是一种对语言不理解的逃避(个人观点)。</p>
<h3 id="来看几道经典的题目："><a href="#来看几道经典的题目：" class="headerlink" title="来看几道经典的题目："></a>来看几道经典的题目：</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[] == [] <span class="regexp">//</span> false</span><br><span class="line">[] == ![] <span class="regexp">//</span> true</span><br><span class="line">&#123;&#125; == !&#123;&#125; <span class="regexp">//</span> false</span><br><span class="line">&#123;&#125; == &#123;&#125; <span class="regexp">//</span> false</span><br></pre></td></tr></table></figure>
<h6 id="是不是很奇怪？本文将从书中看到的知识与规范相结合，来详细说明一下JavaScript在类型转换时候发生的故事。"><a href="#是不是很奇怪？本文将从书中看到的知识与规范相结合，来详细说明一下JavaScript在类型转换时候发生的故事。" class="headerlink" title="是不是很奇怪？本文将从书中看到的知识与规范相结合，来详细说明一下JavaScript在类型转换时候发生的故事。"></a>是不是很奇怪？本文将从书中看到的知识与规范相结合，来详细说明一下JavaScript在类型转换时候发生的故事。</h6><h4 id="JS的数据类型"><a href="#JS的数据类型" class="headerlink" title="JS的数据类型"></a>JS的数据类型</h4><p>首先，回想一下JS的类型都有什么。<br>原始值（primitives）： undefined， null， booleans， numbers，strings， symbol（es6）<br>对象值（objects）： Object</p>
<h4 id="ToPrimitive"><a href="#ToPrimitive" class="headerlink" title="ToPrimitive"></a>ToPrimitive</h4><p>在发生转换的时候，js其实都是会将操作对象转化为原始的对象，这也是最为诟病的地方，因为js很难直接抛出错误，她会用一套自己的方法去理解我们的错误，并做相应的调整，哪怕这些错误我们是无意识的。所以我们要知道她的转换方式，才能做到知己知彼，对代码的控制更为精准。</p>
<h6 id="签名：ToPrimitive-input-PreferredType-x2F-x2F-PreferredType-Number-或者-String"><a href="#签名：ToPrimitive-input-PreferredType-x2F-x2F-PreferredType-Number-或者-String" class="headerlink" title="签名：ToPrimitive(input, PreferredType?) &#x2F;&#x2F;PreferredType: Number 或者 String"></a>签名：ToPrimitive(input, PreferredType?) &#x2F;&#x2F;PreferredType: Number 或者 String</h6><h6 id="流程如下："><a href="#流程如下：" class="headerlink" title="流程如下："></a>流程如下：</h6><p>input为原始值，直接返回；<br>不是原始值，调用该对象的valueOf()方法，如果结果是原始值，返回原始值；<br>调用valueOf()不是原始值，调用此对象的toString()方法，如果结果为原始值，返回原始值；<br>如果返回的不是原始值，抛出异常TypeError。<br>其中PreferredType控制线调取valueOf()还是toString()。</p>
<p>ps: Date类型按照String去调用。</p>
<h4 id="总结：-x3D-x3D-操作符"><a href="#总结：-x3D-x3D-操作符" class="headerlink" title="总结：&#x3D;&#x3D;操作符"></a>总结：&#x3D;&#x3D;操作符</h4><h5 id="比较运算-x-x3D-x3D-y，其中x和y是值，产生true或者false。这样的比较如下方式进行："><a href="#比较运算-x-x3D-x3D-y，其中x和y是值，产生true或者false。这样的比较如下方式进行：" class="headerlink" title="比较运算 x&#x3D;&#x3D;y，其中x和y是值，产生true或者false。这样的比较如下方式进行："></a>比较运算 x&#x3D;&#x3D;y，其中x和y是值，产生true或者false。这样的比较如下方式进行：</h5><p>一、若Type(x)与Type(y)相同，则：<br>　　　a.若Type(x)为Undefined，返回true。<br>　　　b.若Type(x)为Null，返回true。<br>　　　c.若Type(x)为Number，则：<br>　　　　1.若x为NaN，返回false。<br>　　　　2.若y为NaN，返回false。<br>　　　　3.若x与y为相等数值，返回true。<br>　　　　4.若x为+0且y为-0，返回true。<br>　　　　5.若x为-0且y为+0，返回true。<br>　　　　6.返回false。<br>　　　d.若Type(x)为String，则当x和y完全相等的字符序列（长度相等且相同字符在相同位置）时返回true。否则，返回false。<br>　　　e.当Type(x)为Boolean，当x和y同为true或者同为false时返回true。否则，返回false。<br>　　　f.当x和y为引用同一对象时返回true。否则，返回false。<br>二、若x为null且y为undefined，返回true。<br>三、若x为undefined且y为null，返回true。<br>四、若Type(x)为number且Type(y)为String，返回comparison x&#x3D;&#x3D;ToNumber(y)的结果。<br>五、若Type(x)为String且Type(y)为Number，返回comparison ToNumber(x) &#x3D;&#x3D; y的结果。<br>六、若Type(x)为Boolean，返回比较ToNumber(x) &#x3D;&#x3D; y的结果。<br>七、若Type(x)为Boolean，返回比较x &#x3D;&#x3D; ToNumber(y)的结果。<br>八、若Type(x)为String或Number，且Type(y)为Object，返回比较x &#x3D;&#x3D; ToPrimitive(y)的结果。<br>九、若Type(x)为Object且Type(y)为String或Number，返回比较ToPrimitive(x) &#x3D;&#x3D; y的结果。<br>十、返回false。</p>
<h6 id="上图中的-toPrimitive-就是对象转基本类型。"><a href="#上图中的-toPrimitive-就是对象转基本类型。" class="headerlink" title="上图中的 toPrimitive 就是对象转基本类型。"></a>上图中的 toPrimitive 就是对象转基本类型。</h6><h5 id="这里来解析一道题目-x3D-x3D-x2F-x2F-gt-true-，下面是这个表达式为何为-true-的步骤"><a href="#这里来解析一道题目-x3D-x3D-x2F-x2F-gt-true-，下面是这个表达式为何为-true-的步骤" class="headerlink" title="这里来解析一道题目 [] &#x3D;&#x3D; ![] &#x2F;&#x2F; -&gt; true ，下面是这个表达式为何为 true 的步骤"></a>这里来解析一道题目 [] &#x3D;&#x3D; ![] &#x2F;&#x2F; -&gt; true ，下面是这个表达式为何为 true 的步骤</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> [] 转成 true，然后取反变成 false</span><br><span class="line">[] == false</span><br><span class="line"><span class="regexp">//</span> 根据第 <span class="number">8</span> 条得出</span><br><span class="line">[] == ToNumber(false)</span><br><span class="line">[] == <span class="number">0</span></span><br><span class="line"><span class="regexp">//</span> 根据第 <span class="number">10</span> 条得出</span><br><span class="line">ToPrimitive([]) == <span class="number">0</span></span><br><span class="line"><span class="regexp">//</span> [].toString() -&gt; <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span> == <span class="number">0</span></span><br><span class="line"><span class="regexp">//</span> 根据第 <span class="number">6</span> 条得出</span><br><span class="line"><span class="number">0</span> == <span class="number">0</span> <span class="regexp">//</span> -&gt; true</span><br></pre></td></tr></table></figure>

<h4 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h4><p>#####ToString<br>按照以下规则转化被传递的参数</p>
<table>
<thead>
<tr>
<th>ArgumentType</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>Undefined</td>
<td>“undefined”</td>
</tr>
<tr>
<td>Null</td>
<td>“null”</td>
</tr>
<tr>
<td>Boolean</td>
<td>true -&gt; “true”false – &gt; “false”</td>
</tr>
<tr>
<td>Number</td>
<td>1：’NaN -&gt; “NaN”。 2：+0 -0 -&gt; “0”。 3：-1 -&gt; “-1。 4：”infinity -&gt; “Infinity”</td>
</tr>
<tr>
<td>String</td>
<td>不转换 直接返回</td>
</tr>
<tr>
<td>Object</td>
<td>1：调用ToPrimitive抽象操作, hint 为 String 将返回值作为 value。2：返回ToString(value)。</td>
</tr>
</tbody></table>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">String</span><span class="params">(undefined)</span></span> <span class="comment">// &quot;undefined&quot;</span></span><br><span class="line"><span class="function"><span class="title">String</span><span class="params">(null)</span></span> <span class="comment">// &quot;null&quot;</span></span><br><span class="line"><span class="function"><span class="title">String</span><span class="params">(true)</span></span> <span class="comment">// &quot;true&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="ToNumber"><a href="#ToNumber" class="headerlink" title="ToNumber"></a>ToNumber</h5><p>按照以下规则转换被传递参数</p>
<table>
<thead>
<tr>
<th>Argument Type</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>Undefined</td>
<td>NaN</td>
</tr>
<tr>
<td>Null</td>
<td>+0</td>
</tr>
<tr>
<td>Boolean</td>
<td>1：true -&gt; 1。 2：false -&gt; +0。</td>
</tr>
<tr>
<td>Number</td>
<td>直接返回</td>
</tr>
<tr>
<td>String</td>
<td>如果不是一个字符串型数字，则返回NaN(具体规则见规范9.3.1)</td>
</tr>
<tr>
<td>Object</td>
<td>1：调用ToPrimitive抽象操作, hint 为 Number 将返回值作为 value。 2：返回ToNumber(value)。</td>
</tr>
</tbody></table>
<h5 id="ToBoolean"><a href="#ToBoolean" class="headerlink" title="ToBoolean"></a>ToBoolean</h5><p>按照以下规则转换被传递参数</p>
<table>
<thead>
<tr>
<th>Argument Type</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>Undefined</td>
<td>false</td>
</tr>
<tr>
<td>Null</td>
<td>false</td>
</tr>
<tr>
<td>Boolean</td>
<td>直接返回</td>
</tr>
<tr>
<td>Number</td>
<td>1：+0 -0 NaN -&gt; false。 2：其他为true。</td>
</tr>
<tr>
<td>String</td>
<td>1：空字符串(length为0) -&gt; false。 2：其他为true。</td>
</tr>
<tr>
<td>Object</td>
<td>true</td>
</tr>
</tbody></table>
<h5 id="ToPrimitive-1"><a href="#ToPrimitive-1" class="headerlink" title="ToPrimitive"></a>ToPrimitive</h5><p>顾名思义，该抽象操作定义了该如何将值转为基础类型(非对象)，接受2个参数，第一个必填的要转换的值，第二个为可选的hint，暗示被转换的类型。</p>
<p>按照以下规则转换被传递参数</p>
<table>
<thead>
<tr>
<th>Argument Type</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>Undefined</td>
<td>直接返回</td>
</tr>
<tr>
<td>Null</td>
<td>直接返回</td>
</tr>
<tr>
<td>Boolean</td>
<td>直接返回</td>
</tr>
<tr>
<td>Number</td>
<td>直接返回</td>
</tr>
<tr>
<td>String</td>
<td>直接返回</td>
</tr>
<tr>
<td>Object</td>
<td>返回一个对象的默认值。一个对象的默认值是通过调用该对象的内部方法[[DefaultValue]]来获取的，同时传递可选参数hint。</td>
</tr>
</tbody></table>
<h6 id="DefaultValue-hint"><a href="#DefaultValue-hint" class="headerlink" title="[[DefaultValue]] (hint)"></a>[[DefaultValue]] (hint)</h6><p>当传递的hint为 String 时候，</p>
<ul>
<li>如果该对象的toString方法可用则调用toString<br>　　如果toString返回了一个原始值(除了object的基础类型)val，则返回val<br>　　　　如果该对象的valueOf方法可用则调用valueOf方法<br>　　如果valueOf返回了一个原始值(除了object的基础类型)val，则返回val<br>　　　　抛出TypeError的异常<br>　　当传递的hint为 Number 时候，</li>
<li>如果该对象的valueOf方法可用则调用valueOf方法<br>　　如果valueOf返回了一个原始值(除了object的基础类型)val，则返回val<br>　　　　如果该对象的toString方法可用则调用toString<br>　　如果toString返回了一个原始值(除了object的基础类型)val，则返回val<br>　　　　抛出TypeError的异常</li>
<li>hint的默认值为Number，除了Date object<br>举个栗子<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">a</span> = &#123;&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.toString</span> = function () &#123;return <span class="number">1</span>&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.valueOf</span> = function () &#123;return <span class="number">2</span>&#125;</span><br><span class="line"><span class="function"><span class="title">String</span><span class="params">(a)</span></span> <span class="comment">// &quot;1&quot;</span></span><br><span class="line"><span class="function"><span class="title">Number</span><span class="params">(a)</span></span> <span class="comment">// 2</span></span><br><span class="line"><span class="selector-tag">a</span> + <span class="string">&#x27;&#x27;</span> <span class="comment">// &quot;2&quot;   ???????</span></span><br><span class="line">+<span class="selector-tag">a</span> <span class="comment">// 2</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.toString</span> = null</span><br><span class="line"><span class="function"><span class="title">String</span><span class="params">(a)</span></span> <span class="comment">// &quot;2&quot;</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.valueOf</span> = null</span><br><span class="line"><span class="function"><span class="title">String</span><span class="params">(a)</span></span> <span class="comment">// Uncaught TypeError: balabala</span></span><br></pre></td></tr></table></figure>
似乎我们发现了一个很不合规范的返回值，为什么 a + ‘’不应该返回”1″吗</li>
</ul>
<p>问题的答案其实很简单 + 操作符会对两遍的值进行 toPrimitive 操作。由于没有传递 hint 参数，那么就会先调用a.valueOf 得到2后因为+右边是字符串，所以再对2进行ToString抽象操作后与””的字符串拼接。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/Blog/2018/08/20/node_js/%E6%8E%A8%E8%8D%90Koa%C2%B7js%E7%9A%84%E5%8D%81%E4%B8%AA%E4%B8%AD%E9%97%B4%E4%BB%B6/index/">推荐Koa.js的十个中间件</a><a class="next" href="/Blog/2018/08/08/essay/javascript-%E6%9F%AF%E9%87%8C%E5%8C%96/index/">javascript-柯里化</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
  clientID: 'e4a44394ea630529848c',
  clientSecret: '884b4deb2d55fbcc63921e12f73b58e944efa110',
  repo: 'Blog',
  owner: 'zch233',
  admin: ['zch233'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="./about/" title="About"><img class="nofancybox" src="/Blog/img/avatar.png"/></a><p>coder.</p><a class="info-icon" href="zch2333333@gmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/zch233" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/Lisp/">Lisp</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/Node-js/">Node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/Rails/">Rails</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/SCSS/">SCSS</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/Shell/">Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/TypeScript/">TypeScript</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/chrome%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7/">chrome调试技巧</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/daisy/">daisy</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/relearnFE/">relearnFE</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/%E5%87%86%E5%A4%87%E9%9D%A2%E8%AF%95/">准备面试</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/%E6%97%A5%E5%B8%B8%E6%9D%82%E7%96%91/">日常杂疑</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/%E8%B6%A3%E9%97%BB/">趣闻</a></li><li class="category-list-item"><a class="category-list-link" href="/Blog/categories/%E9%9A%8F%E7%AC%94/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/08/27/essay/AI%E8%81%8A%E5%A4%A9prompt/index/">AI聊天prompt</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/17/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9AJS-TS/index/">TypeScript全解：JS&TS</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/16/typescript/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/index/">React 泛型组件是什么？</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/15/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9A%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D%EF%BC%88%E4%B8%8A%EF%BC%89/index/">TypeScript全解：类型体操（上）</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/15/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9A%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D%EF%BC%88%E4%B8%8B%EF%BC%89/index/">TypeScript全解：类型体操（下）</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/14/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9Aclass%EF%BC%88%E4%B8%8B%EF%BC%89/index/">TypeScript全解：class（下）</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/14/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9Aclass%EF%BC%88%E4%B8%8A%EF%BC%89/index/">TypeScript全解：class（上）</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/12/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9A%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/index/">TypeScript全解：泛型编程（下）</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/12/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9A%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/index/">TypeScript全解：泛型编程（上）</a></li><li class="post-list-item"><a class="post-list-link" href="/Blog/2023/06/11/typescript/TypeScript%E5%85%A8%E8%A7%A3%EF%BC%9A%E6%B7%B1%E5%85%A5%E5%AF%B9%E8%B1%A1%E4%B8%8E%E5%87%BD%E6%95%B0%EF%BC%88%E4%B8%8B%EF%BC%89/index/">TypeScript全解：深入对象与函数（下）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://www.jianshu.com/u/4b4c7aec223d" title="littleyu" target="_blank">littleyu</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/Blog/." rel="nofollow">zch233.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/Blog/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/Blog/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/Blog/css/search.css?v=1.0.0"><script type="text/javascript" src="/Blog/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/Blog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/Blog/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/Blog/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/Blog/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/Blog/js/smartresize.js?v=1.0.0"></script></div></body></html>